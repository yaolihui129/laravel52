var DATA;
var ops;
var leftMenu;
var treeMenus;
// 面板类
Deskpanel = function(me) {
	return me = {
		init : function() {
			
		}
	}
}()
// 导航类
Navbar = function(me) {
	return me = {
		initOwn : function() {
		},
		init : function() {
			me.initOwn();
			me.create();
			me.bindEvent();
		},
		create : function() {
			me.changeTab();
			me.createTopNavbar();// 上导航
			me.createLeftNavbar();// 左导航
		},
		createTopNavbar : function() {// <ul id='topUl' class='nav
										// navbar-nav'></ul>
			$("#topWrapper").append("<nav class='navbar navbar-fixed-top' role='navigation'>"+
					"<div class='navbar-header'>"+"<a class='navbar-brand' href='#'>云测平台云测平台LOGO</a>" +
							"<a class='navbar-minimalize minimalize-styl-2 btn btn-primary' href='#'>" +
							"<i class='fa fa-bars'></i> </a></div><div class='form-group'>" +
							"<ul id='topUl' class='nav navbar-nav'></ul></div></nav>");
			/*
			 * var classfiies = DATA.menu; var active="active"; for ( var i = 0;
			 * i < classfiies.length; i++) { if(i!=0) active=""; var cls
			 * =classfiies[i]; // <img" + " src='" + cls.icon + "' title='" +
			 * cls.name + "' /> $("#topUl").append("<li><a href='#'
			 * class='"+active+"'><h4>"+cls.name+"</h4></a></li>"); }
			 */
		},
		createLeftNavbar : function() {
			$("#leftWrapper").append("<nav class='navbar-default navbar-static-side' role='navigation'>" +
					"<div class='nav-close'><i class='fa fa-times-circle'></i></div>" +
					"<div class='sidebar-collapse'><ul class='nav' id='side-menu'></ul></div></nav>");
			for ( var op in DATA.menu) {
				for ( var i = 0; i < treeMenus.length; i++) {
					var pmenu = treeMenus[i];
					if (pmenu.classfiyId != DATA.menu[op].code)
						continue;
					drawMenu(pmenu,"side-menu");
				}
			}
			// 递归拼写菜单
			function drawMenu(menu,navId,level=1){
				var sonMenus = menu.sonMenu;
				var sonLen=sonMenus.length;
				if(sonLen){
					var navLevelCss="nav-second-level";
					switch(level){
					case 2:
						navLevelCss="nav-third-level";
						break;
					}
					level++;
					var tempNavId=navId+"_"+menu.appid;
					$("#"+navId).append(
							"<li><a href=''> <i class='fa fa-home'></i><span class='nav-label'>"+menu.name+"</span>" +
							"<span class='fa arrow'></span></a><ul id='"+tempNavId+"' class='nav'></ul></li>");
					$("#"+tempNavId).addClass(navLevelCss);
					for ( var i = 0; i < sonLen; i++) {
						drawMenu(sonMenus[i],tempNavId,level);
					}
				}else{
					$("#"+navId).append("<li><a class='J_menuItem' href='"+menu.url+"'>"+
							menu.name+"</a></li>");
				}
			}
		},
		bindEvent : function() {
			/*
			 * modify by zhangfj 2016-9-1 $(".J_menuItem").each(function(t) {
			 * $(this).attr("data-index") || $(this).attr("data-index", t) });
			 * $(".J_menuItem").on("click", n); $(".J_menuTabs").on("click",
			 * ".J_menuTab i", s); $(".J_tabCloseOther").on("click", r);
			 * $(".J_tabShowActive").on("click", o);
			 * $(".J_menuTabs").on("click", ".J_menuTab", d);
			 * $(".J_menuTabs").on("dblclick", ".J_menuTab", c);
			 * $(".J_tabLeft").on("click", a); $(".J_tabRight").on("click", i);
			 * $(".J_tabCloseAll").on("click", function() {
			 * $(".page-tabs-content").children("[data-id]").not(":first").each(function() {
			 * $('.J_iframe[data-id="' + $(this).data("id") + '"]').remove(),
			 * $(this).remove() }),
			 * $(".page-tabs-content").children("[data-id]:first").each(function() {
			 * $('.J_iframe[data-id="' + $(this).data("id") + '"]').show(),
			 * $(this).addClass("active") }),
			 * $(".page-tabs-content").css("margin-left", "0") });
			 */
		},
		changeTab : function(thisObj) {
		}
	}
}()
function NavToggle() {
    $(".navbar-minimalize").trigger("click")
}
function SmoothlyMenu() {
    $("body").hasClass("mini-navbar") ? $("body").hasClass("fixed-sidebar") ? ($("#side-menu").hide(), setTimeout(function() {
        $("#side-menu").fadeIn(500)
    },
    300)) : $("#side-menu").removeAttr("style") : ($("#side-menu").hide(), setTimeout(function() {
        $("#side-menu").fadeIn(500)
    },
    100))
}
function localStorageSupport() {
    return "localStorage" in window && null !== window.localStorage
}
$(document).ready(function() {
    CommonUtil.requestService("/desktop/menus", "", false, "get",
    function(data, status) {
        if (data.success) { // 成功
            DATA = CommonUtil.parseToJson(data.allmenus.DATA);
            ops = data.allmenus.ops;
            leftMenu = data.allmenus.leftMenu;
            treeMenus = CommonUtil.parseToJson(data.allmenus.treeMenus);
            Deskpanel.init();
            Navbar.init();
        } else {}
    },function(error) {});
    function a() {
        var a = $("body > #wrapper").height() - 61;
        $(".sidebard-panel").css("min-height", a + "px")
    }
    $("#side-menu").metisMenu(),
    $(".right-sidebar-toggle").click(function() {
        $("#right-sidebar").toggleClass("sidebar-open")
    }),
    $(".sidebar-container").slimScroll({
        height: "100%",
        railOpacity: .4,
        wheelStep: 10
    }),
    $(".open-small-chat").click(function() {
        $(this).children().toggleClass("fa-comments").toggleClass("fa-remove"),
        $(".small-chat-box").toggleClass("active")
    }),
    $(".small-chat-box .content").slimScroll({
        height: "234px",
        railOpacity: .4
    }),
    $(".check-link").click(function() {
        var a = $(this).find("i"),
        e = $(this).next("span");
        return a.toggleClass("fa-check-square").toggleClass("fa-square-o"),
        e.toggleClass("todo-completed"),
        !1
    }),
    $(function() {
        $(".sidebar-collapse").slimScroll({
            height: "100%",
            railOpacity: .9,
            alwaysVisible: !1
        })
    }),
    $(".navbar-minimalize").click(function() {
        $("body").toggleClass("mini-navbar"),
        SmoothlyMenu()
    }),
    a(),
    $(window).bind("load resize click scroll",
    function() {
        $("body").hasClass("body-small") || a()
    }),
    $(window).scroll(function() {
        $(window).scrollTop() > 0 && !$("body").hasClass("fixed-nav") ? $("#right-sidebar").addClass("sidebar-top") : $("#right-sidebar").removeClass("sidebar-top")
    }),
    $(".full-height-scroll").slimScroll({
        height: "100%"
    }),
    $("#side-menu>li").click(function() {
        $("body").hasClass("mini-navbar") && NavToggle()
    }),
    $("#side-menu>li li a").click(function() {
        $(window).width() < 769 && NavToggle()
    }),
    $(".nav-close").click(NavToggle)
}),
$(window).bind("load resize",
function() {
    $(this).width() < 769 && ($("body").addClass("mini-navbar"), $(".navbar-static-side").fadeIn())
}),
$(function() {
    if ( localStorageSupport) {
        var a = localStorage.getItem("collapse_menu"),
        e = localStorage.getItem("fixednavbar"),
        i = localStorage.getItem("boxedlayout"),
        l = $("body");
        "on" == a && (l.hasClass("body-small") || l.addClass("mini-navbar")),
        "on" == e && ($(".navbar-static-top").removeClass("navbar-static-top").addClass("navbar-fixed-top"), l.addClass("fixed-nav")),
        "on" == i && l.addClass("boxed-layout")
    }
});